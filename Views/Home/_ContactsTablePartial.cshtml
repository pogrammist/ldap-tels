@model IEnumerable<ContactViewModel>
<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>ФИО</th>
                <th>Должность</th>
                <th>Телефон</th>
                <th>Email</th>
            </tr>
        </thead>
        <tbody>
            @{
                var ordered = Model
                    .OrderBy(c => c.Division ?? string.Empty)
                    .ThenBy(c => c.Department ?? string.Empty)
                    .ThenBy(c => c.DisplayName ?? string.Empty)
                    .ToList();

                string? currentDivision = null;
                string? currentDepartment = null;
            }

            @foreach (var contact in ordered)
            {
                var hasDivision = !string.IsNullOrWhiteSpace(contact.Division);
                var hasDepartment = !string.IsNullOrWhiteSpace(contact.Department);
                var divisionName = hasDivision ? contact.Division : null;
                var departmentName = hasDepartment ? contact.Department : null;

                if (divisionName != null && currentDivision != divisionName)
                {
                    currentDivision = divisionName;
                    currentDepartment = null; // сбрасываем отдел при смене подразделения
                    <tr class="table-secondary">
                        <td colspan="4">
                            <a asp-action="Division" asp-route-division="@contact.Division" class="fw-bold text-decoration-none">@divisionName</a>
                        </td>
                    </tr>
                }

                if (departmentName != null && currentDepartment != departmentName)
                {
                    currentDepartment = departmentName;
                    <tr class="table-light">
                        <td colspan="4">
                            <a asp-action="Department" asp-route-department="@contact.Department" class="text-decoration-none">@departmentName</a>
                        </td>
                    </tr>
                }

                <tr>
                    <td>@contact.DisplayName</td>
                    <td>
                        <a asp-action="Title" asp-route-title="@contact.Title">
                            @contact.Title
                        </a>
                    </td>
                    <td>@contact.PhoneNumber</td>
                    <td>
                        @if (!string.IsNullOrEmpty(contact.Email))
                        {
                            <a href="mailto:@contact.Email">@contact.Email</a>
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>
